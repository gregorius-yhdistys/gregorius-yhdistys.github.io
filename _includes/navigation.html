<nav
  class="flex flex-row px-8 py-3 transition-all duration-500 items-center justify-between fixed top-0 w-full z-50 {% if page.title == '' %}text-white{% else %}bg-white !text-brand{% endif %}"
>
  <a
    href="{% if navlang == 'en' %}/en{% else %}/{% endif %}"
    class="flex flex-row items-center select-none !no-underline"
  >
    <img
      src="/assets/images/logo/SSGM_160.png"
      alt="{{ site.data.strings.nav_logo_alt }}"
      draggable="false"
      class="w-16 md:w-20"
    />
    <div>
      <div class="uppercase text-sm md:text-xl pl-4 font-bold">
        Gregorius-yhdistys
      </div>
      <div class="uppercase text-xs md:text-lg pl-4 font-bold">
        Society of St. Gregory the Great
      </div>
    </div>
  </a>
  <div class="lg:flex lg:flex-row lg:items-center text-lg hidden">
    <!-- <a
      class="mx-3 hover:underline hover:underline-offset-2"
      href="/{{ site.data.strings.nav_news_url }}"
      >{{ site.data.strings.nav_news }}</a
    > -->
    <!-- <a
      class="mx-3 hover:underline hover:underline-offset-2"
      href="/{{ site.data.strings.nav_liturgy_url }}"
      >{{ site.data.strings.nav_liturgy }}</a
    > -->
    <!-- <a
      class="mx-3 hover:underline hover:underline-offset-2"
      href="/{{ site.data.strings.nav_documents_url }}"
      >{{ site.data.strings.nav_documents }}</a
    > -->
    {% if page.url contains site.data.strings.nav_programmes_url %}
    <span class="mx-3 font-semibold text-brand relative after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-full after:h-0.5 after:bg-brand">{{ site.data.strings.nav_programmes }}</span>
    {% else %}
    <a
      class="mx-3 hover:relative hover:after:content-[''] hover:after:absolute hover:after:bottom-0 hover:after:left-0 hover:after:w-full hover:after:h-0.5 hover:after:bg-brand"
      href="/{{ site.data.strings.nav_programmes_url }}"
      >{{ site.data.strings.nav_programmes }}</a
    >
    {% endif %}
    {% if page.url contains site.data.strings.nav_mass_location_url %}
    <span class="mx-3 font-semibold text-brand relative after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-full after:h-0.5 after:bg-brand">{{ site.data.strings.nav_mass_location }}</span>
    {% else %}
    <a
      class="mx-3 hover:relative hover:after:content-[''] hover:after:absolute hover:after:bottom-0 hover:after:left-0 hover:after:w-full hover:after:h-0.5 hover:after:bg-brand"
      href="/{{ site.data.strings.nav_mass_location_url }}"
      >{{ site.data.strings.nav_mass_location }}</a
    >
    {% endif %}
    {% if page.url contains site.data.strings.nav_about_url %}
    <span class="mx-3 font-semibold text-brand relative after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-full after:h-0.5 after:bg-brand">{{ site.data.strings.nav_about }}</span>
    {% else %}
    <a
      class="mx-3 hover:relative hover:after:content-[''] hover:after:absolute hover:after:bottom-0 hover:after:left-0 hover:after:w-full hover:after:h-0.5 hover:after:bg-brand"
      href="/{{ site.data.strings.nav_about_url }}"
      >{{ site.data.strings.nav_about }}</a
    >
    {% endif %}
    {% if page.url contains site.data.strings.nav_contact_url %}
    <span class="mx-3 font-semibold text-brand relative after:content-[''] after:absolute after:bottom-0 after:left-0 after:w-full after:h-0.5 after:bg-brand">{{ site.data.strings.nav_contact }}</span>
    {% else %}
    <a
      class="mx-3 hover:relative hover:after:content-[''] hover:after:absolute hover:after:bottom-0 hover:after:left-0 hover:after:w-full hover:after:h-0.5 hover:after:bg-brand"
      href="/{{ site.data.strings.nav_contact_url }}"
      >{{ site.data.strings.nav_contact }}</a
    >
    {% endif %}
    <!-- <a
      class="mx-3 hover:underline hover:underline-offset-2"
      href="/{{ site.data.strings.nav_contacts_url }}"
      >{{ site.data.strings.nav_contacts }}</a
    > -->
    {% for lang in site.languages %} {% if lang != site.active_lang %} {% if
    lang == site.default_lang %}
    <a href=" {{ page.url }}" class="uppercase" title="{% if lang == 'en' %}English{% elsif lang == 'fi' %}Suomeksi{% else %}{{ lang | upcase }}{% endif %}">
      <img
        class="w-10 mx-4 border border-brand rounded-full"
        src="/assets/images/icons/flags/{{ lang }}.svg"
        alt="{% if lang == 'en' %}English{% elsif lang == 'fi' %}Suomeksi{% else %}{{ lang | upcase }}{% endif %}"
      />
    </a>
    {% else %}
    <a href="/{{ lang }}{{ page.url }}" class="uppercase" title="{% if lang == 'en' %}English{% elsif lang == 'fi' %}Suomeksi{% else %}{{ lang | upcase }}{% endif %}">
      <img
        class="w-10 mx-4 border border-brand rounded-full"
        src="/assets/images/icons/flags/{{ lang }}.svg"
        alt="{% if lang == 'en' %}English{% elsif lang == 'fi' %}Suomeksi{% else %}{{ lang | upcase }}{% endif %}"
      />
    </a>
    {% endif %} {% endif %} {% endfor %}
  </div>
  <button class="text-lg p-4 block lg:hidden cursor-pointer focus:outline-none bg-transparent border-none" id="mobile-menu-button" type="button" aria-label="Open mobile menu" onclick="console.log('Button clicked via onclick'); document.getElementById('mobile-side-menu').classList.toggle('show'); document.getElementById('mobile-menu-overlay').classList.toggle('show');">
    <i class="fa fa-bars text-2xl" aria-hidden="true"></i>
  </button>
</nav>

<!-- Mobile Side Menu -->
<div id="mobile-side-menu" class="fixed top-0 right-0 w-80 h-full bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 lg:hidden">
  <div class="flex flex-col h-full">
    <!-- Close Button -->
    <div class="flex justify-end p-4">
      <button id="mobile-menu-close" class="text-2xl text-gray-600 hover:text-brand focus:outline-none bg-transparent border-none" aria-label="Close mobile menu" onclick="console.log('Close button clicked via onclick'); document.getElementById('mobile-side-menu').classList.remove('show'); document.getElementById('mobile-menu-overlay').classList.remove('show'); document.body.classList.remove('menu-open');">
        <i class="fa fa-times" aria-hidden="true"></i>
      </button>
    </div>
    
    <!-- Menu Items -->
    <div class="flex-1 px-6 py-4">
      <nav class="space-y-4">
        {% if page.url contains site.data.strings.nav_programmes_url %}
        <span class="block py-3 text-lg font-semibold text-brand border-l-4 border-brand pl-3">{{ site.data.strings.nav_programmes }}</span>
        {% else %}
        <a
          class="block py-3 text-lg text-gray-700 hover:text-brand hover:border-l-4 hover:border-brand hover:pl-3"
          href="/{{ site.data.strings.nav_programmes_url }}"
          >{{ site.data.strings.nav_programmes }}</a
        >
        {% endif %}
        {% if page.url contains site.data.strings.nav_mass_location_url %}
        <span class="block py-3 text-lg font-semibold text-brand border-l-4 border-brand pl-3">{{ site.data.strings.nav_mass_location }}</span>
        {% else %}
        <a
          class="block py-3 text-lg text-gray-700 hover:text-brand hover:border-l-4 hover:border-brand hover:pl-3"
          href="/{{ site.data.strings.nav_mass_location_url }}"
          >{{ site.data.strings.nav_mass_location }}</a
        >
        {% endif %}
        {% if page.url contains site.data.strings.nav_about_url %}
        <span class="block py-3 text-lg font-semibold text-brand border-l-4 border-brand pl-3">{{ site.data.strings.nav_about }}</span>
        {% else %}
        <a
          class="block py-3 text-lg text-gray-700 hover:text-brand hover:border-l-4 hover:border-brand hover:pl-3"
          href="/{{ site.data.strings.nav_about_url }}"
          >{{ site.data.strings.nav_about }}</a
        >
        {% endif %}
        {% if page.url contains site.data.strings.nav_contact_url %}
        <span class="block py-3 text-lg font-semibold text-brand border-l-4 border-brand pl-3">{{ site.data.strings.nav_contact }}</span>
        {% else %}
        <a
          class="block py-3 text-lg text-gray-700 hover:text-brand hover:border-l-4 hover:border-brand hover:pl-3"
          href="/{{ site.data.strings.nav_contact_url }}"
          >{{ site.data.strings.nav_contact }}</a
        >
        {% endif %}
      </nav>
      
      <!-- Language Switcher -->
      <div class="mt-8 pt-6 border-t border-gray-200">
        <div class="flex space-x-3">
          {% for lang in site.languages %} {% if lang != site.active_lang %} {% if
          lang == site.default_lang %}
          <a href=" {{ page.url }}" class="flex items-center space-x-2 text-sm text-gray-600 hover:text-brand">
            <img
              class="w-6 border border-brand rounded-full"
              src="/assets/images/icons/flags/{{ lang }}.svg"
            />
            <span>{% if lang == 'en' %}English{% elsif lang == 'fi' %}Suomeksi{% else %}{{ lang | upcase }}{% endif %}</span>
          </a>
          {% else %}
          <a href="/{{ lang }}{{ page.url }}" class="flex items-center space-x-2 text-sm text-gray-600 hover:text-brand">
            <img
              class="w-6 border border-brand rounded-full"
              src="/assets/images/icons/flags/{{ lang }}.svg"
            />
            <span>{% if lang == 'en' %}English{% elsif lang == 'fi' %}Suomeksi{% else %}{{ lang | upcase }}{% endif %}</span>
          </a>
          {% endif %} {% endif %} {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mobile Menu Overlay -->
<div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden" onclick="console.log('Overlay clicked via onclick'); document.getElementById('mobile-side-menu').classList.remove('show'); this.classList.remove('show'); document.body.classList.remove('menu-open');"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('Mobile menu script loaded');
  
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileSideMenu = document.getElementById('mobile-side-menu');
  const mobileMenuClose = document.getElementById('mobile-menu-close');
  const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
  const body = document.body;

  console.log('Elements found:', {
    button: mobileMenuButton,
    menu: mobileSideMenu,
    close: mobileMenuClose,
    overlay: mobileMenuOverlay
  });

  // Debug close button specifically
  if (mobileMenuClose) {
    console.log('Close button found:', mobileMenuClose);
  } else {
    console.error('Close button not found!');
  }

  function openMobileMenu() {
    console.log('Opening mobile menu');
    mobileSideMenu.classList.add('show');
    mobileMenuOverlay.classList.add('show');
    mobileMenuButton.classList.add('open');
    body.classList.add('menu-open');
    
    // Debug overlay visibility
    console.log('Overlay classes after opening:', mobileMenuOverlay.className);
    console.log('Overlay display style:', window.getComputedStyle(mobileMenuOverlay).display);
  }

  function closeMobileMenu() {
    console.log('Closing mobile menu');
    mobileSideMenu.classList.remove('show');
    mobileMenuOverlay.classList.remove('show');
    mobileMenuButton.classList.remove('open');
    body.classList.remove('menu-open');
  }

  // Open menu when button is clicked
  if (mobileMenuButton) {
    mobileMenuButton.addEventListener('click', function(e) {
      console.log('Button clicked');
      e.preventDefault();
      e.stopPropagation();
      
      // Visual feedback
      mobileMenuButton.style.backgroundColor = 'rgba(0,0,0,0.1)';
      setTimeout(() => {
        mobileMenuButton.style.backgroundColor = '';
      }, 150);
      
      openMobileMenu();
    });
  } else {
    console.error('Mobile menu button not found');
  }

  // Close menu when close button is clicked
  if (mobileMenuClose) {
    mobileMenuClose.addEventListener('click', function(e) {
      console.log('Close button clicked via event listener');
      e.preventDefault();
      e.stopPropagation();
      
      // Visual feedback
      mobileMenuClose.style.backgroundColor = 'rgba(0,0,0,0.1)';
      setTimeout(() => {
        mobileMenuClose.style.backgroundColor = '';
      }, 150);
      
      closeMobileMenu();
    });
  } else {
    console.error('Close button not found for event listener');
  }

  // Close menu when overlay is clicked
  if (mobileMenuOverlay) {
    console.log('Overlay found, adding click listener');
    mobileMenuOverlay.addEventListener('click', function(e) {
      console.log('Overlay clicked');
      e.preventDefault();
      e.stopPropagation();
      closeMobileMenu();
    });
  } else {
    console.error('Overlay not found!');
  }

  // Close menu when escape key is pressed
  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape' && mobileSideMenu && mobileSideMenu.classList.contains('show')) {
      closeMobileMenu();
    }
  });

  // Close menu when window is resized to desktop size
  window.addEventListener('resize', function() {
    if (window.innerWidth >= 1024) { // lg breakpoint
      closeMobileMenu();
    }
  });
});
</script>
